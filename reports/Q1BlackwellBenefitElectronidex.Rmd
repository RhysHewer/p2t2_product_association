---
title: "Blacwell Electronidex benefits"
author: "Rhys Hewer"
date: "19 November 2018"
output: html_document
---
Would Blackwell benefit from selling any of Electronidex's items?
===============================



```{r message=FALSE} 
#load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(RColorBrewer)
library(tibble)
library(arules)
library(arulesViz)
library(caret)
library(readr)
library(pdftools)
library(stringr)
library(gridExtra)
```

To answer the question of whether Blackwell would benefit from selling any of Electroidex's products we need a way to compare the products sold between the two companies. By doing this and, additionally, using the transaction data from Electronidex we can see whether there are any relationships between the shared products and the electronidex products which would suggest that Blackwell should stock products they currently do not.

Ideally, the products would be compared on an item-for-item basis. As this is not available, the products will be compared on a product-type-for-product-type basis.

The process to be used for this is as follows:

* Collate the product type information of the Electronidex items.
* Convert the transactional data from item to product type.
* Explore positive associations between shared product types (product types stocked both by both Blackwell and Electronidex) and Electronidex-only products.
* For Electronidex-only product types with positive relationships to shared product types, make recommendations about which of these Blackwell should sell.


```{r}
#load csv data
transData <- read.transactions("data/ElectronidexTransactions2017.csv", format = "basket", sep = ",")
prodData <- read.csv("data/ElectronidexTransactions2017.csv", header = FALSE)


### Loading PDF Elecronited product type data
text <- pdf_text("data/ElectronidexItems2017.pdf")

text2 <- strsplit(text, "\n")
text2 <- text2 %>% unlist(recursive = TRUE)

text3 <- gsub("\r", "", text2)

prod.list <- text3 %>% as.data.frame()

##create product type lists
laptop.list <- prod.list[2:11,1] %>% as.character() %>% trimws("l")
desktop.list <- prod.list[13:21,1] %>% as.character() %>% trimws("l")
monitor.list <- prod.list[23:32,1] %>% as.character() %>% trimws("l")
mice.list <- prod.list[34:43,1] %>% as.character() %>% trimws("l")
keyboard.list <- prod.list[45:53,1] %>% as.character() %>% trimws("l")
mousekeyboard.list <- prod.list[55:63,1] %>% as.character() %>% trimws("l")
compheadphones.list <- prod.list[64:74,1] %>% as.character() %>% trimws("l")
activeheadphones.list <- prod.list[76:81,1] %>% as.character() %>% trimws("l")
compcords.list <- prod.list[83:91,1] %>% as.character() %>% trimws("l")
accessories.list <- prod.list[93:96,1] %>% as.character() %>% trimws("l")
speakers.list <- prod.list[98:106,1] %>% as.character() %>% trimws("l")
printers.list <- prod.list[108:112,1] %>% as.character() %>% trimws("l")
printink.list <- prod.list[114:118,1] %>% as.character() %>% trimws("l")
compstands.list <- prod.list[120:124,1] %>% as.character() %>% trimws("l")
comptablets.list <- prod.list[126:130,1] %>% as.character() %>% trimws("l")
extdrives.list <- prod.list[132:136,1] %>% as.character() %>% trimws("l")
smarthome.list <- prod.list[138:142,1] %>% as.character() %>% trimws("l")

##additional products added to lists
laptop.list <- c(laptop.list, "Alienware Laptop", "Apple MacBook Pro", "Eluktronics Pro Gaming Laptop", "ASUS Chromebook")
activeheadphones.list <- c(activeheadphones.list, "Panasonic On-Ear Stereo Headphones", "APIE Bluetooth Headphone", 
                           "Otium Wireless Sports Bluetooth Headphone", "Philips Flexible Earhook Headphone")
comptablets.list <- c(comptablets.list, "tabletlet", "tablet Pro")
printink.list <- c(printink.list, "printer Toner")
extdrives.list <- c(extdrives.list, "Slim extdrive")

#string replacement lists
prodReplace <- function(x,y){
        list1 <- x %>% as.data.frame()
        list1$name <- y
        list2 <- list1$name
        names(list2) <- list1$.
        list2
}

laptop.replace <- prodReplace(laptop.list, "laptop")
desktop.replace <- prodReplace(desktop.list, "desktop")
monitor.replace <- prodReplace(monitor.list, "monitor")
mice.replace <- prodReplace(mice.list, "mouse")
keyboard.replace <- prodReplace(keyboard.list, "keyboard")
mousekeyboard.replace <- prodReplace(mousekeyboard.list, "mousekeyboard")
compheadphones.replace <- prodReplace(compheadphones.list, "compheadphones")
activeheadphones.replace <- prodReplace(activeheadphones.list, "activeheadphones")
compcords.replace <- prodReplace(compcords.list, "compcord")
accessories.replace <- prodReplace(accessories.list, "accessories")
speakers.replace <- prodReplace(speakers.list, "speaker")
printers.replace <- prodReplace(printers.list, "printer")
printink.replace <- prodReplace(printink.list, "printink")
compstands.replace <- prodReplace(compstands.list, "compstand")
comptablets.replace <- prodReplace(comptablets.list, "tablet")
extdrives.replace <- prodReplace(extdrives.list, "extdrive")
smarthome.replace <- prodReplace(smarthome.list, "smarthome")

#String replacement function
stringReplace <- function(z){
        inList <- z
        repLace <- prodData
        repLace <- sapply(repLace, function(x) str_replace_all(x, inList))
        data.frame(repLace)
}

productList <- c(laptop.replace, desktop.replace, monitor.replace, mice.replace, keyboard.replace, mousekeyboard.replace,
                 compheadphones.replace, activeheadphones.replace, compcords.replace, accessories.replace, speakers.replace,
                 printers.replace, printink.replace, compstands.replace, comptablets.replace, extdrives.replace, smarthome.replace)

typePrep <- stringReplace(productList)

#not all products were included on product type list
# "Alienware Laptop", "Apple MacBook Pro", "Eluktronics Pro Gaming Laptop", "Panasonic On-Ear Stereo Headphones", 
# "tabletlet", "APIE Bluetooth Headphone", "ASUS Chromebook", "Otium Wireless Sports Bluetooth Headphone",  "printer Toner" 
# "Philips Flexible Earhook Headphone", "Slim extdrive", "tablet Pro"  - added to relevant product replacement lists    


#CSV creation/re-import
write.table(typePrep, file = "output/typePrep.csv", sep=",", row.names = FALSE, col.names = FALSE)
typeData <- read.transactions("output/typePrep.csv", format = "basket", sep=",")
inspect(typeData[1:10])
summary(typeData)



#Outputs
save(transData, file = "output/transData.RDS")
save(prodData, file = "output/prodData.RDS")
save(typeData, file = "output/typeData.RDS")
```


